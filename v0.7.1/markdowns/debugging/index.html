<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Debugging ActionModels · ActionModels.jl</title><meta name="title" content="Debugging ActionModels · ActionModels.jl"/><meta property="og:title" content="Debugging ActionModels · ActionModels.jl"/><meta property="twitter:title" content="Debugging ActionModels · ActionModels.jl"/><meta name="description" content="Documentation for ActionModels.jl."/><meta property="og:description" content="Documentation for ActionModels.jl."/><meta property="twitter:description" content="Documentation for ActionModels.jl."/><meta property="og:url" content="https://ComputationalPsychiatry.github.io/ActionModels.jl/markdowns/debugging/"/><meta property="twitter:url" content="https://ComputationalPsychiatry.github.io/ActionModels.jl/markdowns/debugging/"/><link rel="canonical" href="https://ComputationalPsychiatry.github.io/ActionModels.jl/markdowns/debugging/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">ActionModels.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><span class="tocitem">Welcome to ActionModels</span><ul><li><a class="tocitem" href="../../">Welcome to ActionModels!</a></li></ul></li><li><span class="tocitem">Theory</span><ul><li><a class="tocitem" href="../theory/">Computational cognitive modelling</a></li><li><a class="tocitem" href="../references/">References</a></li></ul></li><li><span class="tocitem">User Guide</span><ul><li><a class="tocitem" href="../../generated/2_defining_models/">Defining models with ActionModels</a></li><li><a class="tocitem" href="../../generated/3_simulation/">Simulating states and behaviour</a></li><li><a class="tocitem" href="../../generated/4_model_fitting/">Fitting action models to data</a></li><li><a class="tocitem" href="../../generated/5_population_models/">Population models</a></li><li><a class="tocitem" href="../../generated/6_workflow_tools/">Tools for Bayesian workflows</a></li><li><a class="tocitem" href="../../generated/7_using_submodels/">Using submodels</a></li><li class="is-active"><a class="tocitem" href>Debugging ActionModels</a><ul class="internal"><li><a class="tocitem" href="#Test-for-errors-in-the-action-model-itself"><span>Test for errors in the action model itself</span></a></li><li><a class="tocitem" href="#Test-simulation"><span>Test simulation</span></a></li><li><a class="tocitem" href="#Check-parameter-inference"><span>Check parameter inference</span></a></li><li><a class="tocitem" href="#Check-the-data"><span>Check the data</span></a></li><li><a class="tocitem" href="#Hand-code-a-minimal-Turing-model"><span>Hand-code a minimal Turing model</span></a></li><li><a class="tocitem" href="#Create-an-issue"><span>Create an issue</span></a></li><li><a class="tocitem" href="#Common-sources-of-errors"><span>Common sources of errors</span></a></li></ul></li><li><a class="tocitem" href="../full_API/">Full API reference</a></li></ul></li><li><span class="tocitem">Premade Models</span><ul><li><a class="tocitem" href="../../generated/rescorla_wagner/">The Rescorla-Wagner</a></li><li><a class="tocitem" href="../../generated/pvl_delta/">The PVL-Delta</a></li></ul></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../../generated/example_jget/">Jumping Gaussian Estimation Task</a></li><li><a class="tocitem" href="../../generated/example_igt/">Iowa Gambling Task</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">User Guide</a></li><li class="is-active"><a href>Debugging ActionModels</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Debugging ActionModels</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/ComputationalPsychiatry/ActionModels.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/ComputationalPsychiatry/ActionModels.jl/blob/main/docs/src/markdowns/debugging.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Debugging-ActionModels"><a class="docs-heading-anchor" href="#Debugging-ActionModels">Debugging ActionModels</a><a id="Debugging-ActionModels-1"></a><a class="docs-heading-anchor-permalink" href="#Debugging-ActionModels" title="Permalink"></a></h1><p>ActionModels creates a Turing model under the hood. It is convenient for usability that users do not have to define their own Turing model, but debugging Turing models can be complex, even when they are hand-crafted. This section provides some tips on how to debug ActionModels models, which can be useful when the model does not run as expected, and when it is unclear why.</p><h2 id="Test-for-errors-in-the-action-model-itself"><a class="docs-heading-anchor" href="#Test-for-errors-in-the-action-model-itself">Test for errors in the action model itself</a><a id="Test-for-errors-in-the-action-model-itself-1"></a><a class="docs-heading-anchor-permalink" href="#Test-for-errors-in-the-action-model-itself" title="Permalink"></a></h2><p>The first step whe debugging an action model is often to make sure that the action model function itself functions correctly. The user should run the function step-by-step, replacing the parameters and states taken from the ModelAttributes object with values that are known to be correct.</p><h2 id="Test-simulation"><a class="docs-heading-anchor" href="#Test-simulation">Test simulation</a><a id="Test-simulation-1"></a><a class="docs-heading-anchor-permalink" href="#Test-simulation" title="Permalink"></a></h2><p>The next step is to ensure that the model works correctly for simulation. It is an advantage to start here, because the complexity of Turing&#39;s inference engine can make it difficult to identify the source of errors. The user should run the model with a standard set of parameters and observations, and check that the output matches the expected output.</p><h2 id="Check-parameter-inference"><a class="docs-heading-anchor" href="#Check-parameter-inference">Check parameter inference</a><a id="Check-parameter-inference-1"></a><a class="docs-heading-anchor-permalink" href="#Check-parameter-inference" title="Permalink"></a></h2><p>If the above steps work as expected, it is time to fit the model to data. It is recommended to start with a small, handcrafted dataset, which is known to work with the model. If this works, the user can return to the full dataset that the model originally errorred on.</p><h2 id="Check-the-data"><a class="docs-heading-anchor" href="#Check-the-data">Check the data</a><a id="Check-the-data-1"></a><a class="docs-heading-anchor-permalink" href="#Check-the-data" title="Permalink"></a></h2><p>Sometimes, an action model will error only with specific input series (given some parameters and an autodiff backend too). This is often the case if the model fitting works with a subset of the data, but not with the full dataset. In this case, it can be an advantage to fit the data with various subsets to find the specific session(s) that cause the problem. Then, the user can repeat the steps above with only the problematic session(s) to see where the problem comes from. </p><h2 id="Hand-code-a-minimal-Turing-model"><a class="docs-heading-anchor" href="#Hand-code-a-minimal-Turing-model">Hand-code a minimal Turing model</a><a id="Hand-code-a-minimal-Turing-model-1"></a><a class="docs-heading-anchor-permalink" href="#Hand-code-a-minimal-Turing-model" title="Permalink"></a></h2><p>If the above keep giving problems, users can create a hand-coded minimal Turing model with just the components needed to run the model. This might look like this, with a Rescorla-Wagner model:</p><pre><code class="language-julia hljs">
@model function testmodel()
    
    #Prepare observations and actions
    observations = [0.1, 0.2, 0.3]
    actions = [0.1, 0.1, 0.4]

    #Sample parameters
    learning_rate ~ LogitNormal()
    action_noise ~ LogNormal()

    #Set initial value
    expected_value = 0.0

    #Go through each observation
    for (observation, action) in zip(observations, actions)

        #Update the expected value
        expected_value += learning_rate * (observation - expected_value)

        #Sample the action
        action ~ Normal(expected_value, action_noise)
    end
end

model = testmodel()

sample(model, NUTS, 1000)
</code></pre><p>If this function runs, there is some specificity in either the data or the population model specification - or, of course, and error in ActionModels - which is the problem. Users should try using the exact observations and actions that cause problems in the dataset, or to deliberately use very wide priors, and see if they can replicate the error. </p><h2 id="Create-an-issue"><a class="docs-heading-anchor" href="#Create-an-issue">Create an issue</a><a id="Create-an-issue-1"></a><a class="docs-heading-anchor-permalink" href="#Create-an-issue" title="Permalink"></a></h2><p>If none of the above works, users should feel free to create an issue on the ActionModels Github repo, and we can do our best to help. Note that, if the error found above is known to be due to a specific autodifferentiation backend, the error should be reported to them - but it might be difficult to know exactly what caused the problem, and if the user is unable to create a proper MWE, we can perhaps help with that.</p><h2 id="Common-sources-of-errors"><a class="docs-heading-anchor" href="#Common-sources-of-errors">Common sources of errors</a><a id="Common-sources-of-errors-1"></a><a class="docs-heading-anchor-permalink" href="#Common-sources-of-errors" title="Permalink"></a></h2><h3 id="Check-that-bounded-parameters-are-within-bounds"><a class="docs-heading-anchor" href="#Check-that-bounded-parameters-are-within-bounds">Check that bounded parameters are within bounds</a><a id="Check-that-bounded-parameters-are-within-bounds-1"></a><a class="docs-heading-anchor-permalink" href="#Check-that-bounded-parameters-are-within-bounds" title="Permalink"></a></h3><p>One common source of problems is if bounded parameters are not within bounds. It is recommended to double-check that all parameters are bounded appropriately. This includes setting appropirate priors in the independent session population model, and using appropriate inverse link functions in the regression population model.</p><h3 id="Consider-the-choice-of-priors"><a class="docs-heading-anchor" href="#Consider-the-choice-of-priors">Consider the choice of priors</a><a id="Consider-the-choice-of-priors-1"></a><a class="docs-heading-anchor-permalink" href="#Consider-the-choice-of-priors" title="Permalink"></a></h3><p>Inappropriate priors can easily lead to plroblems with inference, either because they make the sampler not able to estimate the posterior, or simply because they lead to extreme parameter values that can cause errors. It is especially important to consider if priors are well-specified when using the default priors in ActionModels, which may not be appropriate for the specific model. Generally, it can be an advantage when debugging to start with very narrow priors to see if that allows the model to run, and then widen the priors from there.</p><h3 id="Consider-underflow-and-overflow"><a class="docs-heading-anchor" href="#Consider-underflow-and-overflow">Consider underflow and overflow</a><a id="Consider-underflow-and-overflow-1"></a><a class="docs-heading-anchor-permalink" href="#Consider-underflow-and-overflow" title="Permalink"></a></h3><p>Especially when sampling is it possible to get values that cannot be represented in the computer&#39;s memory. This can easily happen when values get very close to some bound (e.g. 0 or 1 for probabilities). In this case, a value that should have been close to but not equal to 0 becomes 0, for example. This can easily lead to infinities, NaN values and errors (for example if log-transformations are used). If encountering such errors, it is recommended to check the values of the parameters and observations, and see if underflow is the culprit. If it is, it can be a simple solution to add or subtract a simple epsilon value, or use <code>clamp</code> to ensure that values do not get too close to the bounds. Often, it is also a solution to use more narrow priors.</p><h3 id="Consider-the-choice-of-autodifferentiation-backend"><a class="docs-heading-anchor" href="#Consider-the-choice-of-autodifferentiation-backend">Consider the choice of autodifferentiation backend</a><a id="Consider-the-choice-of-autodifferentiation-backend-1"></a><a class="docs-heading-anchor-permalink" href="#Consider-the-choice-of-autodifferentiation-backend" title="Permalink"></a></h3><p>Turing supports multiple autodifferentiation backends, which have different advantages and disadvantages. Some backends can lead to errors or wrong calculations in specific situations.  To check whether a problem is related to the autodifferentiation backend, it is recommended to try running the model with a different backend. The ForwardDiff backend is slower but more robust, so users may investigate whether switching to this backend solves the problem. If it does solve the problem, the user may consider reporting the problem to the developers of the backend which gave the error, so that it can be fixed in future versions. For this, it is often necessary to provide a minimal working example that reproduces the error, so that the developers can investigate it. This can be a bit complicated to do, since it involves creating a Turing model from scratch, but if help is needed, the ActionModels developers can assist with this. See the Turing <a href="https://turinglang.org/ADTests/">ADTest</a> testsuite for examples of where the different backends might fail.</p><h3 id="Check-that-gradients-can-be-calculated"><a class="docs-heading-anchor" href="#Check-that-gradients-can-be-calculated">Check that gradients can be calculated</a><a id="Check-that-gradients-can-be-calculated-1"></a><a class="docs-heading-anchor-permalink" href="#Check-that-gradients-can-be-calculated" title="Permalink"></a></h3><p>It can sometimes be the case that gradients cannot be calculated for the parameters. This can happen for various reasons, including the priors being ill specified.  The following code command can be used to extract the gradient and logdensity, given a model, an autodiff backend, and some specified parameter values. It cna be convenient to use parameter values that are one sample from the prior, as below.</p><pre><code class="language-julia hljs">
#Sample a single set of parameter values from the prior
params = DynamicPPL.VarInfo(model)[:]

#Calculate the logdensity and gradient
LogDensityProblems.logdensity_and_gradient(
    LogDensityFunction(model; adtype = ad_type),
    params,
)</code></pre><h3 id="Matrix-mutation"><a class="docs-heading-anchor" href="#Matrix-mutation">Matrix mutation</a><a id="Matrix-mutation-1"></a><a class="docs-heading-anchor-permalink" href="#Matrix-mutation" title="Permalink"></a></h3><p>One point which can cause issues with some autodiff backends is matrix mutation, especially on multivariate states or parameters. The same operation can often be implemented without matrix mutation; it is recommended to test whether this can solve any problems.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../generated/7_using_submodels/">« Using submodels</a><a class="docs-footer-nextpage" href="../full_API/">Full API reference »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.13.0 on <span class="colophon-date" title="Wednesday 25 June 2025 08:20">Wednesday 25 June 2025</span>. Using Julia version 1.11.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
